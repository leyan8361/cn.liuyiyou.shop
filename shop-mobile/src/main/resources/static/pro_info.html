<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>产品详情</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <link rel="stylesheet" href="lib/weui.min.css">
    <link rel="stylesheet" href="css/jquery-weui.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body ontouchstart>
<!--主体-->
<div class="weui-content">
    <!--产品详情-->
    <div class="weui-tab">
        <div class="weui-navbar" style="position:fixed; top:0; left:0; right:0; height:44px;">
            <a class="weui-navbar__item proinfo-tab-tit weui-bar__item--on" href="#tab1">商品</a>
            <a class="weui-navbar__item proinfo-tab-tit" href="#tab2">详情</a>
            <a class="weui-navbar__item proinfo-tab-tit" href="#tab3">评价</a>
        </div>
        <div class="weui-tab__bd proinfo-tab-con">
            <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active">
                <!--主图轮播-->
                <div class="swiper-container swiper-zhutu">
                    <div class="swiper-wrapper" id="swiper">
                    </div>
                    <div class="swiper-pagination swiper-zhutu-pagination"></div>
                </div>
                <div class="wy-media-box-nomg weui-media-box_text">
                    <div style="display:none;" id="prodId"></div>
                    <div style="display:none;" id="signleSku"></div>
                    <div style="display:none;" id="skuId"></div>
                    <h4 class="wy-media-box__title" id="prodName"></h4>
                    <div class="wy-pro-pri mg-tb-5">¥<em class="num font-20" id="price"></em></div>
                </div>
            </div>
            <div id="tab2" class="weui-tab__bd-item ">
                <div class="pro-detail">
                </div>
            </div>
        </div>
    </div>
</div>
<span id="tophovertree" title="返回顶部"></span>
<!--底部导航-->
<div class="foot-black"></div>
<div class="weui-tabbar wy-foot-menu">
    <a href="javascript:;" id='show-toast' class="promotion-foot-menu-items">
        <div class="weui-tabbar__icon promotion-foot-menu-collection"></div>
        <p class="weui-tabbar__label">收藏</p>
    </a>
    <a href="shopcart.html" class="promotion-foot-menu-items">
        <span class="weui-badge" style="position: absolute;top: -.4em;right: 1em;"></span>
        <div class="weui-tabbar__icon promotion-foot-menu-cart"></div>
        <p class="weui-tabbar__label">购物车</p>
    </a>
    <a href="javascript:;" class="weui-tabbar__item yellow-color open-popup" data-target="#join_cart">
        <p class="promotion-foot-menu-label">加入购物车</p>
    </a>
    <a href="javascript:;" class="weui-tabbar__item red-color open-popup" data-target="#selcet_sku">
        <p class="promotion-foot-menu-label">立即购买</p>
    </a>
</div>
<div id="join_cart" class='weui-popup__container popup-bottom' style="z-index:600;">
    <div class="weui-popup__overlay" style="opacity:1;"></div>
    <div class="weui-popup__modal">
        <div class="modal-content">
            <div class="weui-msg" style="padding-top:0;">
                <div class="weui-msg__icon-area"><i class="weui-icon-success weui-icon_msg"></i></div>
                <div class="weui-msg__text-area">
                    <h2 class="weui-msg__title">成功加入购物车</h2>
                    <p class="weui-msg__desc">亲爱的用户，您的商品已成功加入购物车，为了保证您的商品快速送达，请您尽快到购物车结算。</p>
                </div>
                <div class="weui-msg__opr-area">
                    <p class="weui-btn-area">
                        <a href="shopcart.html" class="weui-btn weui-btn_primary">去购物车结算</a>
                        <a href="javascript:;" class="weui-btn weui-btn_default close-popup">不，我再看看</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="selcet_sku" class='weui-popup__container popup-bottom' style="z-index:600;">
    <div class="weui-popup__overlay" style="opacity:1;"></div>
    <div class="weui-popup__modal">
        <div class="toolbar">
            <div class="toolbar-inner">
                <a href="javascript:;" class="picker-button close-popup">关闭</a>
                <h1 class="title">商品属性</h1>
            </div>
        </div>
        <div class="modal-content">
            <div class="weui-msg" style="padding-top:0;">
                <div class="wy-media-box2 weui-media-box_text" style="margin:0;" id="sku_list">
                </div>
                <div class="weui-msg__opr-area">
                    <p class="weui-btn-area">
                        <a id="buynow" class="weui-btn weui-btn_primary">确定</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="sku_list_template">
    {{each list}}
    <div class="weui-media-box_appmsg">
        <div class="weui-media-box__hd proinfo-txt-l">
            <span class="promotion-label-tit">{{$value.key}}</span>
        </div>
        <div class="weui-media-box__bd">
            <div class="promotion-sku clear">
                <ul>
                    {{each $value.values}}
                    <li><a href="javascript:;">{{$value}}</a></li>
                    {{/each}}
                </ul>
            </div>
        </div>
    </div>
    {{/each}}
    <div class="weui-media-box_appmsg">
        <div class="weui-media-box__hd proinfo-txt-l"><span class="promotion-label-tit">数量</span></div>
        <div class="weui-media-box__bd">
            <div class="promotion-sku clear">
                <div class="Spinner"></div>
            </div>
        </div>
    </div>
</script>

<script src="lib/jquery-2.1.4.js"></script>
<script src="lib/fastclick.js"></script>
<script type="text/javascript" src="js/jquery.Spinner.js"></script>
<script>
    $(function () {
        FastClick.attach(document.body);
    });
</script>
<script src="js/jquery-weui.js"></script>
<script src="js/swiper.js"></script>

<script src="js/common.js?v=2"></script>
<script src="js/constant.js?v=2"></script>
<script src="lib/template-web.js"></script>

<script type="text/javascript">
    $(document).ready(function () {
        getProd();

        $("#buynow").click(function () {
            buynow();
        });
    });

    function getProd() {
        var prodId = getQueryStr("id");
        var url = PROD_BASE_URL + "/prod/" + prodId;
        $.ajax({
            type: "get",
            url: url,
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                console.info(data)
                if (data.success) {
                    var prod = data.data;
                    $("#prodName").text(prod.prodName);
                    $("#prodId").text(prod.prodId)
                    prod.albums.forEach(function (item) {
                        var picUrl = OSS_URL + item;
                        $("#swiper").append('<div class="swiper-slide"><img src="' + picUrl + '"/></div>');
                    });

                    $("#price").text(prod.prodSkus[0].price);

                    if (prod.skuKeyListValue.length == 0) {
                        $("#signleSku").text(true);
                        $("#skuId").text(prod.prodSkus[0].skuId);
                    }

                    var html = template("sku_list_template", {"list": prod.skuKeyListValue});
                    document.getElementById('sku_list').innerHTML = html;

                    $(".promotion-sku li").click(function () {
                        $(this).addClass("active").siblings("li").removeClass("active");
                    })


                    $(".swiper-zhutu").swiper({
                        loop: true,
                        paginationType: 'fraction',
                        autoplay: 5000
                    });

                    $(".Spinner").Spinner({value: 1, len: 3, max: 999});
                }
            },
            error: function (data) {
            }
        });

    }


    /**
     * 立即购买
     */
    function buynow() {
        var url = ORDER_BASE_URL + "/order/add";
        var params = {};
        params.prodId = $("#prodId").text();
        if ($("#signleSku").text() == true) {
            params.skuId = $("#skuId").text();
        } else {
            params.skuId = 21010106301;
        }

        params.prodNum = $(".Amount").val();
        console.info(params);
        $.ajax({
            type: "post",
            url: url,
            data: JSON.stringify(params),
            dataType: "json",
            contentType: "application/json",
            success: function (data) {
                console.info(data)
                if (data.success) {
                    window.location.href = "/order_info.html?id=" + data.data;
                }
            },
            error: function (data) {
            }
        });

    }

</script>
<script>
    $(document).on("click", "#show-toast", function () {
        $.toast("收藏成功", function () {
            console.log('close');
        });
    })
</script>
<script>
    $(document).on("open", ".weui-popup-modal", function () {
        console.log("open popup");
    }).on("close", ".weui-popup-modal", function () {
        console.log("close popup");
    });
</script>
<script>
    $(function () {
        initTopHoverTree("tophov" + "ertree", 30, 10, 10);
    })
</script>
<script>
    function initTopHoverTree(hvtid, times, right, bottom) {
        $("#" + hvtid).css("right", right).css("bottmo", bottom);
        $("#" + hvtid).on("click", function () {
            goTopHovetree(times);
        })
        $(window).scroll(function () {
            if ($(window).scrollTop() > 268) {
                $("#" + hvtid).fadeIn(100);
            }
            else {
                $("#" + hvtid).fadeOut(100);
            }
        });
    }

    //返回顶部动画
    //goTop(500);//500ms内滚回顶部
    function goTopHovetree(times) {
        if (!!!times) {
            $(window).scrollTop(0);
            return;
        }
        var sh = $('body').scrollTop();//移动总距离
        var inter = 13.333;//ms,每次移动间隔时间
        var forCount = Math.ceil(times / inter);//移动次数
        var stepL = Math.ceil(sh / forCount);//移动步长
        var timeId = null;

        function aniHovertree() {
            !!timeId && clearTimeout(timeId);
            timeId = null;
            if ($('body').scrollTop() <= 0 || forCount <= 0) {
                $('body').scrollTop(0);
                return;
            }
            forCount--;
            sh -= stepL;
            $('body').scrollTop(sh);
            timeId = setTimeout(function () {
                aniHovertree();
            }, inter);
        }

        aniHovertree();
    }
</script>
</body>
</html>
